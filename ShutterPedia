<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShutterPedia - Encyclopedia</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f4f9;
    margin: 0;
    padding: 0;
    color: #333;
}
header {
    background: #4CAF50;
    color: white;
    text-align: center;
    padding: 20px;
}
header h1 { margin: 0; }
#search-container {
    display: flex;
    justify-content: center;
    margin: 20px;
    gap: 10px;
}
#search-input {
    width: 50%;
    padding: 10px;
    font-size: 16px;
    border-radius: 5px;
    border: 1px solid #ccc;
}
#lang-select {
    padding: 10px;
    border-radius: 5px;
}
#search-btn {
    padding: 10px 20px;
    background: #0078d7;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
#search-btn:hover { background: #005fa3; }
#results, #article, #addArticleContainer, #recommendation {
    max-width: 900px;
    margin: 20px auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
}
.result-item {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    cursor: pointer;
}
.result-item:hover { background: #f1f1f1; }
#article img { max-width: 100%; margin: 10px 0; }
#pagination { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
button { cursor: pointer; }
#addArticleContainer input, #addArticleContainer textarea, #addArticleContainer button {
    width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc;
}
</style>
</head>
<body>

<header>
    <h1>ShutterPedia</h1>
    <p>App developed by Samyak Poudel</p>
</header>

<div id="search-container">
    <input type="text" id="search-input" placeholder="Search articles...">
    <select id="lang-select">
        <option value="en">English</option>
        <option value="ne">Nepali</option>
        <option value="hi">Hindi</option>
        <option value="jp">Japanese</option>
    </select>
    <button id="search-btn">Search</button>
</div>

<div id="results"></div>
<div id="pagination"></div>

<div id="article" style="display:none;">
    <h2 id="article-title"></h2>
    <div id="article-content"></div>
    <button id="back-btn">Back</button>
</div>

<div id="addArticleContainer">
    <h2>Add Your Article</h2>
    <input type="text" id="newArticleTitle" placeholder="Title">
    <textarea id="newArticleContent" placeholder="Content"></textarea>
    <input type="text" id="newArticleImage" placeholder="Image URL">
    <button id="addArticleBtn">Add Article</button>
</div>

<div id="recommendation">
    <h2>Recommendations</h2>
    <p>Send your article recommendations or feedback to: <a href="mailto:samupro4576@gmail.com">samupro4576@gmail.com</a></p>
</div>

<script>
// Global Variables
let currentLang = 'en';
let currentQuery = '';
let currentPage = 1;
const resultsPerPage = 10;
let historyStack = [];

// DOM Elements
const searchInput = document.getElementById('search-input');
const searchBtn = document.getElementById('search-btn');
const langSelect = document.getElementById('lang-select');
const resultsDiv = document.getElementById('results');
const paginationDiv = document.getElementById('pagination');
const articleDiv = document.getElementById('article');
const articleTitle = document.getElementById('article-title');
const articleContent = document.getElementById('article-content');
const backBtn = document.getElementById('back-btn');

const addArticleBtn = document.getElementById('addArticleBtn');
const newArticleTitle = document.getElementById('newArticleTitle');
const newArticleContent = document.getElementById('newArticleContent');
const newArticleImage = document.getElementById('newArticleImage');

// Local Articles
let userArticles = JSON.parse(localStorage.getItem('userArticles')) || [];

// Wikipedia REST API search
async function searchArticles(query, lang = 'en', page = 1){
    const offset = (page - 1) * resultsPerPage;
    const url = `https://${lang}.wikipedia.org/w/rest.php/v1/search/page?q=${encodeURIComponent(query)}&limit=${resultsPerPage}&offset=${offset}`;
    const res = await fetch(url);
    const data = await res.json();
    return data.pages || [];
}

// Render search results
function renderResults(results){
    resultsDiv.innerHTML = '';
    results.forEach(r => {
        const div = document.createElement('div');
        div.className = 'result-item';
        div.innerHTML = `<strong>${r.title}</strong><p>${r.description || ''}</p>`;
        div.addEventListener('click', () => showArticle(r.title, currentLang));
        resultsDiv.appendChild(div);
    });
    renderPagination();
}

// Render pagination
function renderPagination(){
    paginationDiv.innerHTML = '';
    if(currentPage > 1){
        const prevBtn = document.createElement('button');
        prevBtn.textContent = 'Previous';
        prevBtn.onclick = () => { currentPage--; search(); };
        paginationDiv.appendChild(prevBtn);
    }
    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'Next';
    nextBtn.onclick = () => { currentPage++; search(); };
    paginationDiv.appendChild(nextBtn);
}

// Fetch and show article content
async function showArticle(title, lang){
    historyStack.push({title, lang});
    articleDiv.style.display = 'block';
    resultsDiv.style.display = 'none';
    paginationDiv.style.display = 'none';

    // Check user articles first
    const userArt = userArticles.find(a => a.title === title);
    if(userArt){
        articleTitle.textContent = userArt.title;
        articleContent.innerHTML = `<p>${userArt.content}</p>${userArt.image ? `<img src="${userArt.image}"/>` : ''}`;
        return;
    }

    const url = `https://${lang}.wikipedia.org/api/rest_v1/page/html/${encodeURIComponent(title)}`;
    try {
        const res = await fetch(url);
        if(res.ok){
            const html = await res.text();
            articleTitle.textContent = title;
            articleContent.innerHTML = html;
        } else {
            articleTitle.textContent = title;
            articleContent.innerHTML = `<p>Content not available.</p>`;
        }
    } catch(e){
        articleTitle.textContent = title;
        articleContent.innerHTML = `<p>Error fetching content.</p>`;
    }
}

// Back button
backBtn.addEventListener('click', () => {
    articleDiv.style.display = 'none';
    resultsDiv.style.display = 'block';
    paginationDiv.style.display = 'flex';
    historyStack.pop();
});

// Search function
async function search(){
    const query = searchInput.value.trim();
    if(!query) return;
    currentQuery = query;
    const results = await searchArticles(query, currentLang, currentPage);
    // Include user articles in search
    const filteredUserArticles = userArticles.filter(a => a.title.toLowerCase().includes(query.toLowerCase()));
    renderResults([...filteredUserArticles, ...results]);
}

// Search button click
searchBtn.addEventListener('click', () => {
    currentPage = 1;
    search();
});

// Language select change
langSelect.addEventListener('change', () => {
    currentLang = langSelect.value;
    if(currentQuery) search();
});

// Add user article
addArticleBtn.addEventListener('click', () => {
    const title = newArticleTitle.value.trim();
    const content = newArticleContent.value.trim();
    const image = newArticleImage.value.trim();
    if(title && content){
        userArticles.push({title, content, image});
        localStorage.setItem('userArticles', JSON.stringify(userArticles));
        newArticleTitle.value = '';
        newArticleContent.value = '';
        newArticleImage.value = '';
        alert('Article added successfully!');
    } else {
        alert('Title and Content are required.');
    }
});

</script>

</body>
</html>
